@using WebMatrix.Data;
@{
    Database db = Database.Open("TodoDbCntStrng");

    int userID = Convert.ToInt32(Session["id"]);
    string useremail = Convert.ToString(Session["email"]);
    string[] splitted = useremail.Split('@');

    string usertype = "";

    if (splitted[1] == "student.nhl.nl")
    {
        usertype = "student";
    }
    else
    {
        usertype = "docent";
    }

}
<!DOCTYPE html>
<html>
<head>
    RenderPage("head.cshtml")
</head>
<body>
    <header>
        RenderPage("menu.cshtml")
    </header>
    <main>
        @{

            if (usertype == "student")
            {

                var vstudieID = db.QueryValue("SELECT StudieID FROM users WHERE Id=@0", userID);
                int studieID = Convert.ToInt32(vstudieID);

                var vakCommand = "SELECT Id, naam FROM courses WHERE studieID =@0";
                var vakken = db.Query(vakCommand, userID);

                if (IsPost)
                {

                    int eId = Convert.ToInt32(Request.Form["enrollen"]);
                    string gebruikerstype = "student";

                    var CoCommand = "SELECT COUNT(id) FROM courses WHERE Id =@0";
                    int CountCourse = Convert.ToInt32(db.QueryValue(CoCommand, eId));

                    var CoECommand = "SELECT COUNT(id) FROM enrolled WHERE CourseID =@0 AND UserId =@1";
                    int ECourse = Convert.ToInt32(db.QueryValue(CoECommand, eId, userID));

                    if (CountCourse == 1 && ECourse == 0)
                    {
                        var insertCommand = "INSERT INTO enrolled (usertype, CourseID, UserId) VALUES(@0, @1, @2)";
                        db.Execute(insertCommand, gebruikerstype, eId, userID);
                        <p>enrolled voor het vak</p>
                    }
                    else
                    {
                        <p class="error">enrolled failed</p>
                    }



                }

                var CoECCommand = "SELECT COUNT(id) FROM courses WHERE studieID =@0";
                int CountECourse = Convert.ToInt32(db.QueryValue(CoECCommand, studieID));

                var CoEnrCommand = "SELECT COUNT(id) FROM enrolled WHERE UserId =@1";
                int EnrCourse = Convert.ToInt32(db.QueryValue(CoEnrCommand, userID));

                if (CountECourse > EnrCourse)
                {
                    <h2>Enroll</h2>
                                    <form action="~/enroll.cshtml" method="post">
                                        <select name="enrollen">
                                            @foreach (var recrod in vakken)
                                            {

                                                <option value="@recrod.Id">@recrod.naam</option>

                                            }
                                        </select>
                                        <input type="submit" value="enroll" />
                                    </form>
                }


            }
            else
            {
                var vstudieID = db.QueryValue("SELECT StudieID FROM admins WHERE Id=@0", userID);
                int studieID = Convert.ToInt32(vstudieID);

                var vakCommand = "SELECT Id, naam FROM courses WHERE studieID =@0";
                var vakken = db.Query(vakCommand, userID);

                <h2>Enroll</h2>
                                    <form action="~/enroll.cshtml" method="post">
                                        <select name="enrollen">
                                            @foreach (var recrod in vakken)
                                            {

                                                <option value="@recrod.Id">@recrod.naam</option>

                                            }
                                        </select>
                                        <input type="submit" value="auto enroll all" />
                                    </form>

            }
        }
    </main>
    <footer>
        RenderPage("footer.cshtml")
    </footer>
</body>
</html>